return function(){function a(a,b){for(h=i.shift(),b=b?b:1;h--;)if(a.push(i.shift()),2==b){for(var c=i.shift().split(","),d=[],e=0;e<c.length;e++)d.push(parseInt(c[e]));a.push(d)}}function b(a,b){if(!b||!a)return!1;for(;b;){if(b==a)return!0;b=b.parentNode}return!1}var c,d,e,f,g,h,i,j=[],k=[],l=[],m=[];for(i=[],e=0;e<arguments.length;e++)i.push(arguments[e]);if(d=i.shift(),a(j),a(k),c=i.shift(),a(l,2),a(m),d)for(e=m.length-1;e>=0;e--)m[e].childNodes&&m[e].childNodes.length&&m.splice(e,1);if(j.length)a:for(e=m.length-1;e>=0;e--){for(f=0;f<j.length;f++)if(b(j[f],m[e]))continue a;m.splice(e,1)}if(k.length)a:for(e=m.length-1;e>=0;e--){for(f=0;f<k.length;f++)if(b(m[e],k[f]))continue a;m.splice(e,1)}if(l.length)a:for(e=m.length-1;e>=0;e--){var n={};for(g=0;g<c;g++)n[g]=!0;for(f=0;f<l.length;f+=2)if(n[l[f+1]]&&b(m[e],l[f]))for(g=0;g<l[f+1].length;g++)delete n[l[f+1][g]];for(g=0;g<c;g++)if(n[g]){m.splice(e,1);continue a}}return m}.apply(this,arguments);